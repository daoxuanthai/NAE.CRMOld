@using tcs.adapter.Models
@model DocumentModels
@if (Model != null)
{
    <table class="table table-striped table-bordered dTableR popuptbl" id="dt_commissionlist">
        <thead>
            <tr>
                <th class="center">Giai đoạn</th>
                <th class="center w80">Bỏ qua</th>
                <th class="center w80">Hoàn tất</th>
                <th class="center w150">Cập nhật</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.ListStep != null && Model.ListStep.Any())
            {
                var rootIndex = 1;
                var lstRoot = Model.ListStep.Where(s => s.StepInfo.ParentId == 0);
                var rootIds = lstRoot.Select(i => i.StepInfo.Id);
                foreach (var root in lstRoot)
                {
                    <tr>
                        <td>
                            <strong class="root">@(rootIndex++). @root.StepInfo.StepName</strong>
                        </td>
                        <td class="center"></td>
                        <td class="center"></td>
                        <td class="center"></td>
                    </tr>
                    var childIndex = 1;
                    var lstChilds = Model.ListStep.Where(s => s.StepInfo.ParentId == root.StepInfo.Id);
                    foreach (var step in lstChilds)
                    {
                        var subIndex = 1;
                        var lstSubs = Model.ListStep.Where(s => s.StepInfo.ParentId == step.StepInfo.Id);
                        <tr>
                            <td>
                                <strong class="child">@(childIndex++). @step.StepInfo.StepName</strong>
                            </td>
                            <td class="center">
                                @if (step.StepInfo.IsStep && step.ListDocumentDetail != null && step.ListDocumentDetail.Count == 1)
                                {
                                    var doc = step.ListDocumentDetail[0];
                                    <input id="isskip_@doc.Id" onchange="return skipDocument(@doc.Id);" type="checkbox" @(doc.IsSkip ? "checked" : "") />
                                }
                            </td>
                            <td class="center">
                                @if (step.StepInfo.IsStep && step.ListDocumentDetail != null && step.ListDocumentDetail.Count == 1)
                                {
                                    var doc = step.ListDocumentDetail[0];
                                    <input id="isdone_@doc.Id" onchange="return completeDocument(@doc.Id);" type="checkbox" @(doc.IsDone ? "checked" : "") />
                                }
                            </td>
                            <td class="center"></td>
                        </tr>
                        foreach (var sub in lstSubs)
                        {
                            <tr>
                                <td>
                                    <strong class="sub">@(subIndex++). @sub.StepInfo.StepName</strong>
                                </td>
                                <td class="center">
                                    @if (sub.StepInfo.IsStep && step.ListDocumentDetail != null && sub.ListDocumentDetail.Count == 1)
                                    {
                                        var doc = sub.ListDocumentDetail[0];
                                        <input id="isskip_@doc.Id" onchange="return skipDocument(@doc.Id);" type="checkbox" @(doc.IsSkip ? "checked" : "") />
                                    }
                                </td>
                                <td class="center">
                                    @if (sub.StepInfo.IsStep && step.ListDocumentDetail != null && sub.ListDocumentDetail.Count == 1)
                                    {
                                        var doc = sub.ListDocumentDetail[0];
                                        <input id="isdone_@doc.Id" onchange="return completeDocument(@doc.Id);" type="checkbox" @(doc.IsDone ? "checked" : "") />
                                    }
                                </td>
                                <td class="center"></td>
                            </tr>
                            if (sub.ListDocumentDetail != null && sub.ListDocumentDetail.Count > 1)
                            {
                                @Html.Partial("_ContractDocumentList", sub.ListDocumentDetail, new ViewDataDictionary { { "Css", "doc-sub" } })
                            }
                        }
                        if (step.ListDocumentDetail != null && step.ListDocumentDetail.Count > 1)
                        {
                            @Html.Partial("_ContractDocumentList", step.ListDocumentDetail, new ViewDataDictionary { { "Css", "doc-child" } })
                        }
                    }
                    if (root.ListDocumentDetail != null && root.ListDocumentDetail.Count > 1)
                    {
                        @Html.Partial("_ContractDocumentList", root.ListDocumentDetail)
                    }
                }
            }
        </tbody>
    </table>
}